---
---


<div class="relative" id="lunr-search">
    <input
      id="searchInput"
      type="search"
      placeholder="Search..."
      class="border rounded px-3 py-2 w-full"
    />
    <ul
      id="results"
      class="absolute bg-white border mt-2 w-full max-h-64 overflow-auto z-50 hidden"
    ></ul>
  </div>
  
  <!-- ✅ Load Lunr globally via UMD CDN (NOT inside <script type="module">) -->
  <script src="https://cdn.jsdelivr.net/npm/lunr/lunr.min.js"></script>
  
  <!-- ✅ Use classic script to access global lunr -->
  <script>
    window.addEventListener("DOMContentLoaded", () => {
      const input = document.getElementById("searchInput");
      const resultsContainer = document.getElementById("results");
  
      if (!input || !resultsContainer || typeof lunr === "undefined") return;
  
      /** @type {lunr.Index} */
      let idx;
      /** @type {{ id: string, title: string, body: string, url: string }[]} */
      let docs;
  
      async function loadIndex() {
        docs = await fetch("/search/index.json").then((r) => r.json());
        idx = lunr(function () {
          this.ref("id");
          this.field("title", { boost: 10 });
          this.field("body");
          docs.forEach((d) => this.add(d));
        });
      }
  
      async function performSearch(query) {
        if (!idx) await loadIndex();
        const results = idx.search(query);
        resultsContainer.innerHTML = "";
  
        if (results.length > 0) {
          resultsContainer.classList.remove("hidden");
          results.forEach(({ ref }) => {
            const doc = docs.find((d) => d.id === ref);
            if (!doc) return;
            const li = document.createElement("li");
            li.className = "p-2 hover:bg-gray-100";
            li.innerHTML = `<a href="${doc.url}">${doc.title}</a>`;
            resultsContainer.appendChild(li);
          });
        } else {
          resultsContainer.classList.add("hidden");
        }
      }
  
      input.addEventListener("input", (e) => {
        performSearch(e.target.value);
      });
    });
  </script>
  